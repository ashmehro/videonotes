function injectScript(e){var t=function(e){return Object.prototype.toString.call(e)=="[object Function]"};var n=function(e){if(!e||!e.length)return e;var t=/['"<>\/]/g,n="",r=0,i;do{i=t.exec(e);n+=i?e.substring(r,t.lastIndex-1)+"\\x"+i[0].charCodeAt(0).toString(16):e.substring(r)}while(i&&(r=t.lastIndex)>0);return n.length?n:e};var r=t(e);var i=document.createElement("script");var s,o,u="";if(r){var a=[];for(var f=1;f<arguments.length;f++){var l=arguments[f];var c;if(t(l))c='eval("'+n("("+l.toString()+")")+'")';else if(Object.prototype.toString.call(l)=="[object Date]")c="(new Date("+l.getTime().toString()+"))";else if(Object.prototype.toString.call(l)=="[object RegExp]")c="(new RegExp("+l.toString()+"))";else if(typeof l==="string"||typeof l==="object")c='JSON.parse("'+n(JSON.stringify(l))+'")';else c=l.toString();a.push(c)}while(u.length<16)u+=String.fromCharCode(!u.length||Math.random()>.5?97+Math.floor(Math.random()*25):48+Math.floor(Math.random()*9));s="(function(){var value={callResult: null, throwValue: false};try{value.callResult=(("+e.toString()+")("+a.join()+"));}catch(e){value.throwValue=true;value.callResult=e;};"+"document.getElementById('"+u+"').innerText=JSON.stringify(value);})();";i.id=u}else{s=e}i.type="text/javascript";i.innerHTML=s;document.head.appendChild(i);if(r){o=JSON.parse(i.innerText);i.parentNode.removeChild(i);delete i;if(o.throwValue)throw o.callResult;else return o.callResult}else return i}function showNotes(e,t,n,r,s){if($("#dialog")){$("#dialog").html("");$("#dialog").remove()}var o=document.createElement("div");o.setAttribute("id","dialog");o.setAttribute("title","Play-n-Note");o.innerHTML=e;if($(".course-modal-frame")){$(".course-modal-frame").after(o)}else if($(".course-modal-frame.course-modal-frame-with-slides")){$(".course-modal-frame.course-modal-frame-with-slides").after(o)}$("#dialog").dialog({dialogClass:"no-close",autoOpen:false,height:350,position:[0,0],zIndex:1e6,modal:false});notes=s.split(r);i=0;$("tr[id^='cmt'] > td > a").each(function(e){if($(this).attr("href").indexOf("deleteNote")>-1){$(this).after(" "+unescape(notes[i])+" ");i++}});$("#dialog").dialog("open");$(".icon-remove").on("click",function(e){$("#dialog").dialog("close")});var u=false;var a=false;var f="0";var l="1";var c=0;$("#commentsTxt").keydown(function(e){if(c==0){if(window.QL_player!=null){window.QL_player.mediaelement_handle.pause();c=window.QL_player.mediaelement_media.currentTime}else if($("me_flash_0")!=null){$("me_flash_0").pauseMedia();c=$("me_flash_0").currentTime()}c=Math.round(parseFloat(c))}if(e.keyCode==67||e.keyCode==70||e.keyCode==72||e.keyCode==80||e.keyCode==187||e.keyCode==189||e.keyCode==191){if(e.keyCode==67){if(a==true||u==true)charval="C";else charval="c"}else if(e.keyCode==70){if(a==true||u==true)charval="F";else charval="f"}else if(e.keyCode==72){if(a==true||u==true)charval="H";else charval="h"}else if(e.keyCode==80){if(a==true||u==true)charval="P";else charval="p"}else if(e.keyCode==187){if(a==true)charval="+";else charval="="}else if(e.keyCode==189){if(a==true)charval="-";else charval="_"}else if(e.keyCode==191){if(a==true)charval="?";else charval="/"}$("#commentsTxt").val($("#commentsTxt").val()+charval);a=false;return false}else if(e.keyCode==37||e.keyCode==38||e.keyCode==39||e.keyCode==40||e.keyCode==27||e.keyCode==107||e.keyCode==109){a=false;return false}else if(e.keyCode==20){u=!u;a=false;return false}else if(e.keyCode==16){a=true;return false}else if(e.keyCode==13){if(window.QL_player!=null){window.QL_player.mediaelement_handle.play()}else if($("me_flash_0")!=null){$("me_flash_0").playMedia()}text=$("#commentsTxt").val();timenow=(new Date).getTime();if($.trim(text)!=""){uId=""+n;uId1=uId.substring(1,10);uId2=uId.substring(10,uId.length-1);content='<a style="font-size:10px" href="javascript:deleteNote('+timenow+", "+uId1+", "+uId2+')"><img src="http://playnnote.herokuapp.com/images/deletecomment.png" alt="Delete"/></a>  '+text+" <a href=javascript:moveTo("+c+"); >"+c+"s</a>";if($("#notesTbl > tbody > tr").length>0){$('<tr id="cmt'+timenow+'"+><td>'+content+"</td></tr>").insertBefore($("table > tbody > tr:first"))}else{$('<tr id="cmt'+timenow+'"><td>'+content+"</td></tr>").insertAfter($("table > tbody"))}text=text.replace(/\n/g,"<br>").trim();$.support.cors=true;$.ajax({type:"POST",url:"http://playnnote.herokuapp.com/submitNoteExtn",data:{googleId:n,videoURL:t,comments:escape(text),noteId:timenow,instant:c,ispublic:false}})}$("#commentsTxt").val("");a=false;c=0;return false}a=false})}function createTableData(e){var t="";tableHeaders="<table id='notesTbl' class='table table-striped table-bordered table-condensed'><tbody>";var n=e.length;for(i=0;i<n;i++){uId="s"+e[i].googleId+"s";uId1=uId.substring(1,10);uId2=uId.substring(10,uId.length-1);t=t+"<tr id='cmt"+e[i].noteId+"'><td><a style='font-size:10px' href='javascript:deleteNote("+e[i].noteId+", "+uId1+", "+uId2+")'><img src='http://playnnote.herokuapp.com/images/deletecomment.png' alt='Delete'/></a><a href=javascript:moveTo("+e[i].instant+"); alt='Delete'>"+e[i].instant+"s</a></td></tr>"}tableEnd="</tbody></table>";var r="<textarea id='commentsTxt' width='100%'></textarea><p></p>";t=r+tableHeaders+t+tableEnd;return t}var moveToStr="function moveTo(toTime) {if (window.QL_player != null) {window.QL_player.mediaelement_handle.setCurrentTime(toTime);} else if ($('me_flash_0') != null) {$('me_flash_0').setCurrentTime(toTime);}} ";var deleteNoteStr="function deleteNote(noteId, uId1, uId2) { uId = '' + uId1 + uId2; $.ajax({type: 'GET', url: 'http://playnnote.herokuapp.com/deleteNoteExtn',data: {gId: uId, noteId: noteId}}); $('#cmt' + noteId).remove();}";data=JSON.parse(notes.notesData);var notesHTML=createTableData(data);var delimiter=""+Math.random().toString(36).substring(0,5);var dataStr="";for(i=0;i<data.length;i++){if(i>0)dataStr+=delimiter;dataStr+=data[i].comments}injectScript(showNotes,notesHTML,ids.vId,ids.gId,delimiter,dataStr);var scr=document.createElement("script");scr.textContent=moveToStr+deleteNoteStr;document.head.appendChild(scr)