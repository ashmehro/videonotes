function isAuthorized(){if($("#dialog")){$("#dialog").html("");$("#dialog").remove()}oauth.authorize(function(){var e="https://www.googleapis.com/oauth2/v2/userinfo";oauth.sendSignedRequest(e,saveGInfo,{parameters:{alt:"json"}})})}function saveGInfo(e,t){var n=JSON.parse(e);uId="s"+n.id+"s";dispName=n.name;chrome.storage.local.set({gId:uId,displayName:dispName});triggerGetNotes()}function triggerGetNotes(){chrome.tabs.query({active:true,currentWindow:true},function(e){var t=e[0].url;var n=t.substring(t.lastIndexOf("/")+1);if(n.indexOf("index")<0){tabId=e[0].id;loadNotes(uId,t,tabId)}})}function loadNotes(e,t,n){var r=/(http|https):\/\/class.coursera.org\/([a-zA-Z0-9-]*)\/lecture\/([0-9]{0,4})/g;var i=r.exec(t);var s=i[2];var o=i[3];vId=s+"_"+o;chrome.storage.local.set({vId:vId,url:t});$.support.cors=true;$.ajax({type:"GET",url:"http://playnnote.herokuapp.com/getNotesExtn",data:{googleId:e,videoURL:vId},success:function(t){strData=JSON.stringify(t);chrome.tabs.executeScript(n,{code:"var notes={notesData: '"+strData+"'};"},function(){chrome.tabs.executeScript(n,{code:"var ids={vId: '"+vId+"', gId: '"+e+"'};"},function(){chrome.tabs.executeScript(n,{file:"src/shownotes.min.js"})})})},error:function(e,t){alert("failure in getting notes");chrome.tabs.executeScript({file:"src/shownotes.min.js"})},dataType:"json"})}function getCurrentTime(){if(window.QL_player!=null){return window.QL_player.mediaelement_media.currentTime}else if($("me_flash_0")!=null){return $("me_flash_0").currentTime()}}var uId;var dispName;var tabId;chrome.runtime.onMessage.addListener(function(e,t,n){var r=getCurrentTime();n({currTime:r})});var oauth=ChromeExOAuth.initBackgroundPage({request_url:"https://www.google.com/accounts/OAuthGetRequestToken",authorize_url:"https://www.google.com/accounts/OAuthAuthorizeToken",access_url:"https://www.google.com/accounts/OAuthGetAccessToken",consumer_key:"anonymous",consumer_secret:"anonymous",scope:"https://www.googleapis.com/auth/userinfo.profile",app_name:"Play-n-Note"});chrome.webNavigation.onCompleted.addListener(isAuthorized,{url:[{hostSuffix:"class.coursera.org"}]})